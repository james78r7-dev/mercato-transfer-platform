<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدير شعارات الأندية - Club Logo Manager</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --dark-bg: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-light: #ecf0f1;
            --border-color: #444;
        }

        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #2c3e50 100%);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .manager-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .manager-header {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .manager-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .manager-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .btn-manager {
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            border: none;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-manager:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-primary-manager {
            background: linear-gradient(45deg, var(--secondary-color), #5dade2);
            color: white;
        }

        .btn-success-manager {
            background: linear-gradient(45deg, var(--success-color), #58d68d);
            color: white;
        }

        .btn-info-manager {
            background: linear-gradient(45deg, #3498db, #5dade2);
            color: white;
        }

        .btn-warning-manager {
            background: linear-gradient(45deg, var(--warning-color), #f7dc6f);
            color: white;
        }

        .btn-danger-manager {
            background: linear-gradient(45deg, var(--danger-color), #ec7063);
            color: white;
        }

        .form-control-manager {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-light);
            padding: 12px 15px;
        }

        .form-control-manager:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
            color: var(--text-light);
        }

        .form-control-manager::placeholder {
            color: rgba(236, 240, 241, 0.6);
        }

        .club-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .club-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--secondary-color);
        }

        .club-logo-preview {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.1);
        }

        .stats-card {
            background: linear-gradient(135deg, var(--secondary-color), #5dade2);
            border-radius: 15px;
            padding: 20px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(236, 240, 241, 0.6);
            z-index: 10;
        }

        .search-input {
            padding-left: 45px;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.error {
            background: var(--danger-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }

        .notification.info {
            background: var(--secondary-color);
        }

        .section-title {
            color: var(--secondary-color);
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.3rem;
        }

        @media (max-width: 768px) {
            .manager-container {
                padding: 10px;
            }
            
            .manager-header,
            .manager-card {
                padding: 15px;
            }
            
            .stats-number {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="manager-container">
        <!-- Header -->
        <div class="manager-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-0">
                        <i class="fas fa-shield-alt text-primary"></i>
                        مدير شعارات الأندية
                    </h1>
                    <p class="mb-0 mt-2 text-muted">إدارة شاملة لشعارات الأندية والربط بين الأسماء العربية والإنجليزية</p>
                    <div id="syncStatus" class="mt-2">
                        <small class="text-success">
                            <i class="fas fa-link"></i> متزامن مع مستخرج الأندية
                        </small>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-primary-manager" onclick="logoManager.syncWithExtractor()">
                        <i class="fas fa-sync-alt"></i> مزامنة مع المستخرج
                    </button>
                    <button class="btn btn-success-manager" onclick="logoManager.exportData()">
                        <i class="fas fa-download"></i> تصدير البيانات
                    </button>
                    <button class="btn btn-info-manager" onclick="logoManager.openExtractor()">
                        <i class="fas fa-external-link-alt"></i> فتح المستخرج
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="totalClubsCount">0</div>
                    <div class="stats-label">إجمالي الأندية</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card" style="background: linear-gradient(135deg, var(--success-color), #58d68d);">
                    <div class="stats-number" id="clubsWithLogosCount">0</div>
                    <div class="stats-label">أندية بشعارات</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card" style="background: linear-gradient(135deg, var(--warning-color), #f7dc6f);">
                    <div class="stats-number" id="clubsWithoutLogosCount">0</div>
                    <div class="stats-label">أندية بدون شعارات</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card" style="background: linear-gradient(135deg, var(--danger-color), #ec7063);">
                    <div class="stats-number" id="mappingIssuesCount">0</div>
                    <div class="stats-label">مشاكل الربط</div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Add/Edit Club Form -->
            <div class="col-md-4">
                <div class="manager-card">
                    <div class="section-title">
                        <i class="fas fa-plus-circle section-icon"></i>
                        إضافة/تعديل نادي
                    </div>
                    
                    <form id="clubForm">
                        <div class="mb-3">
                            <label class="form-label">الاسم العربي</label>
                            <input type="text" class="form-control form-control-manager" id="arabicName" placeholder="مثال: ريال مدريد" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الاسم الإنجليزي</label>
                            <input type="text" class="form-control form-control-manager" id="englishName" placeholder="Example: Real Madrid" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">رابط الشعار</label>
                            <input type="url" class="form-control form-control-manager" id="logoUrl" placeholder="https://example.com/logo.png">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">الدوري</label>
                            <input type="text" class="form-control form-control-manager" id="league" placeholder="مثال: الدوري الإسباني">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">البلد</label>
                            <input type="text" class="form-control form-control-manager" id="country" placeholder="مثال: إسبانيا">
                        </div>
                        
                        <div class="mb-3" id="logoPreviewContainer" style="display: none;">
                            <label class="form-label">معاينة الشعار</label>
                            <div class="text-center">
                                <img id="logoPreview" class="club-logo-preview" style="width: 80px; height: 80px;" alt="معاينة الشعار">
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success-manager">
                                <i class="fas fa-save"></i> حفظ النادي
                            </button>
                            <button type="button" class="btn btn-warning-manager" onclick="logoManager.clearForm()">
                                <i class="fas fa-eraser"></i> مسح النموذج
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Clubs List -->
            <div class="col-md-8">
                <div class="manager-card">
                    <div class="section-title">
                        <i class="fas fa-list section-icon"></i>
                        قائمة الأندية
                    </div>
                    
                    <!-- Search -->
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control form-control-manager search-input" id="searchInput" placeholder="البحث في الأندية...">
                    </div>
                    
                    <!-- Filter Buttons -->
                    <div class="mb-3">
                        <button class="btn btn-primary-manager btn-sm" onclick="logoManager.filterClubs('all')">
                            <i class="fas fa-globe"></i> الكل
                        </button>
                        <button class="btn btn-success-manager btn-sm" onclick="logoManager.filterClubs('with-logos')">
                            <i class="fas fa-check-circle"></i> بشعارات
                        </button>
                        <button class="btn btn-warning-manager btn-sm" onclick="logoManager.filterClubs('without-logos')">
                            <i class="fas fa-exclamation-circle"></i> بدون شعارات
                        </button>
                        <button class="btn btn-danger-manager btn-sm" onclick="logoManager.filterClubs('issues')">
                            <i class="fas fa-times-circle"></i> مشاكل
                        </button>
                    </div>
                    
                    <!-- Loading Spinner -->
                    <div class="loading-spinner" id="loadingSpinner">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p class="mt-2">جاري تحميل البيانات...</p>
                    </div>
                    
                    <!-- Clubs Container -->
                    <div id="clubsContainer">
                        <!-- Clubs will be loaded here -->
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="صفحات الأندية" class="mt-3">
                        <ul class="pagination justify-content-center" id="pagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Club Logo Manager Script -->
    <script src="data-manager.js"></script>
    <script>
        class ClubLogoManager {
            constructor() {
                this.clubs = [];
                this.filteredClubs = [];
                this.currentFilter = 'all';
                this.currentPage = 1;
                this.itemsPerPage = 10;
                this.editingClub = null;

                this.initializeManager();
            }

            async initializeManager() {
                console.log('🚀 Initializing Club Logo Manager...');

                // Setup event listeners
                this.setupEventListeners();

                // Load initial data
                await this.loadClubsData();

                // Update statistics
                this.updateStatistics();

                console.log('✅ Club Logo Manager initialized');
            }

            setupEventListeners() {
                // Form submission
                document.getElementById('clubForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveClub();
                });

                // Logo URL input change for preview
                document.getElementById('logoUrl').addEventListener('input', (e) => {
                    this.previewLogo(e.target.value);
                });

                // Search input
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.searchClubs(e.target.value);
                });

                // Listen for updates from extractor
                window.addEventListener('storage', (e) => {
                    if (e.key === 'verifiedClubs' && e.newValue) {
                        this.handleExtractorUpdate(e.newValue);
                    }
                });

                // Listen for custom events from extractor
                window.addEventListener('clubsDataUpdated', (e) => {
                    if (e.detail.source && e.detail.source.includes('real-verified-extractor')) {
                        this.handleExtractorUpdate(JSON.stringify(e.detail.clubs));
                    }
                });
            }

            handleExtractorUpdate(clubsDataString) {
                try {
                    const clubsData = JSON.parse(clubsDataString);

                    // تحديث البيانات
                    this.clubs = clubsData.map(club => ({
                        id: club.id || this.generateId(),
                        englishName: club.englishName,
                        arabicName: club.arabicName || club.englishName,
                        logoUrl: club.logoUrl,
                        league: club.league || 'غير محدد',
                        country: club.country || 'غير محدد',
                        city: club.city || 'غير محدد',
                        founded: club.founded,
                        stadium: club.stadium || 'غير محدد',
                        capacity: club.capacity,
                        website: club.website,
                        verified: club.verified || true,
                        extractedAt: club.extractedAt || new Date().toISOString(),
                        source: club.source || 'Real Verified Extractor',
                        lastUpdated: new Date().toISOString(),
                        autoSynced: true
                    }));

                    // تحديث العرض
                    this.filteredClubs = [...this.clubs];
                    this.renderClubs();
                    this.updateStatistics();

                    // إشعار المستخدم
                    this.showNotification(`تم تحديث ${this.clubs.length} نادي تلقائياً من المستخرج`, 'success');

                    console.log(`🔄 Auto-updated ${this.clubs.length} clubs from extractor`);

                } catch (error) {
                    console.error('🚨 Error handling extractor update:', error);
                }
            }

            openExtractor() {
                // فتح المستخرج في تبويب جديد
                const extractorUrl = window.location.origin + '/real-verified-extractor-fixed.html';
                window.open(extractorUrl, '_blank');

                this.showNotification('تم فتح مستخرج الأندية في تبويب جديد', 'info');
                console.log('🔗 Opened extractor in new tab');
            }

            updateSyncStatus(status, message) {
                const syncStatusElement = document.getElementById('syncStatus');
                if (syncStatusElement) {
                    let iconClass = 'fas fa-link';
                    let textClass = 'text-success';

                    switch (status) {
                        case 'syncing':
                            iconClass = 'fas fa-sync-alt fa-spin';
                            textClass = 'text-info';
                            break;
                        case 'error':
                            iconClass = 'fas fa-unlink';
                            textClass = 'text-danger';
                            break;
                        case 'success':
                            iconClass = 'fas fa-link';
                            textClass = 'text-success';
                            break;
                    }

                    syncStatusElement.innerHTML = `
                        <small class="${textClass}">
                            <i class="${iconClass}"></i> ${message}
                        </small>
                    `;
                }
            }

            async loadClubsData() {
                try {
                    this.showLoading(true);

                    // Try to get data from server
                    const response = await fetch('/api/clubs-database');

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            this.clubs = result.data.clubs || [];
                            console.log(`📥 Loaded ${this.clubs.length} clubs from server`);
                        }
                    } else {
                        console.warn('⚠️ Failed to load from server, trying localStorage');
                        this.loadFromLocalStorage();
                    }

                    this.filteredClubs = [...this.clubs];
                    this.renderClubs();

                } catch (error) {
                    console.error('🚨 Error loading clubs data:', error);
                    this.showNotification('خطأ في تحميل بيانات الأندية', 'error');
                    this.loadFromLocalStorage();
                } finally {
                    this.showLoading(false);
                }
            }

            loadFromLocalStorage() {
                try {
                    const verifiedClubs = localStorage.getItem('verifiedClubs');
                    const arabicMappings = localStorage.getItem('ARABIC_MAPPINGS');

                    if (verifiedClubs) {
                        const clubs = JSON.parse(verifiedClubs);
                        this.clubs = clubs.map(club => ({
                            id: club.id || this.generateId(),
                            arabicName: club.arabicName || club.name,
                            englishName: club.englishName || club.name,
                            logoUrl: club.logoUrl,
                            league: club.league || 'غير محدد',
                            country: club.country || 'غير محدد',
                            source: 'localStorage'
                        }));
                    }

                    if (arabicMappings) {
                        const mappings = JSON.parse(arabicMappings);
                        Object.entries(mappings).forEach(([english, arabic]) => {
                            const existingClub = this.clubs.find(c =>
                                c.englishName === english || c.arabicName === arabic
                            );

                            if (!existingClub) {
                                this.clubs.push({
                                    id: this.generateId(),
                                    arabicName: arabic,
                                    englishName: english,
                                    logoUrl: null,
                                    league: 'غير محدد',
                                    country: 'غير محدد',
                                    source: 'arabic_mappings'
                                });
                            }
                        });
                    }

                    console.log(`📥 Loaded ${this.clubs.length} clubs from localStorage`);
                } catch (error) {
                    console.error('🚨 Error loading from localStorage:', error);
                    this.clubs = [];
                }
            }

            generateId() {
                return 'club_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            async saveClub() {
                try {
                    const formData = {
                        arabicName: document.getElementById('arabicName').value.trim(),
                        englishName: document.getElementById('englishName').value.trim(),
                        logoUrl: document.getElementById('logoUrl').value.trim(),
                        league: document.getElementById('league').value.trim(),
                        country: document.getElementById('country').value.trim()
                    };

                    if (!formData.arabicName || !formData.englishName) {
                        this.showNotification('يجب إدخال الاسم العربي والإنجليزي', 'warning');
                        return;
                    }

                    if (this.editingClub) {
                        // Update existing club
                        const index = this.clubs.findIndex(c => c.id === this.editingClub.id);
                        if (index !== -1) {
                            this.clubs[index] = {
                                ...this.clubs[index],
                                ...formData,
                                updatedAt: new Date().toISOString()
                            };
                        }
                        this.showNotification('تم تحديث النادي بنجاح', 'success');
                    } else {
                        // Add new club
                        const newClub = {
                            id: this.generateId(),
                            ...formData,
                            createdAt: new Date().toISOString(),
                            source: 'manual'
                        };
                        this.clubs.push(newClub);
                        this.showNotification('تم إضافة النادي بنجاح', 'success');
                    }

                    // Save to server
                    await this.saveToServer();

                    // حفظ في localStorage للبث المباشر
                    this.saveToLocalStorage();

                    // حفظ في النظام الجديد
                    if (window.dataManager && window.dataManager.isInitialized) {
                        await window.dataManager.saveClub(club);
                    }

                    // Update display
                    this.filteredClubs = [...this.clubs];
                    this.renderClubs();
                    this.updateStatistics();
                    this.clearForm();

                } catch (error) {
                    console.error('🚨 Error saving club:', error);
                    this.showNotification('خطأ في حفظ النادي', 'error');
                }
            }

            async saveToServer() {
                try {
                    const response = await fetch('/api/sync-clubs-database', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            clubs: this.clubs,
                            syncTime: Date.now()
                        })
                    });

                    if (response.ok) {
                        console.log('✅ Data saved to server successfully');
                    } else {
                        console.warn('⚠️ Failed to save to server');
                    }
                } catch (error) {
                    console.error('🚨 Error saving to server:', error);
                }
            }

            // حفظ البيانات في localStorage للبث المباشر
            saveToLocalStorage() {
                try {
                    localStorage.setItem('clubManagerData', JSON.stringify(this.clubs));
                    console.log(`💾 تم حفظ ${this.clubs.length} نادي في localStorage`);

                    // إرسال إشعار للصفحات الأخرى
                    window.dispatchEvent(new StorageEvent('storage', {
                        key: 'clubManagerData',
                        newValue: JSON.stringify(this.clubs)
                    }));
                } catch (error) {
                    console.error('❌ خطأ في حفظ البيانات:', error);
                }
            }

            clearForm() {
                document.getElementById('clubForm').reset();
                document.getElementById('logoPreviewContainer').style.display = 'none';
                this.editingClub = null;
            }

            previewLogo(url) {
                const preview = document.getElementById('logoPreview');
                const container = document.getElementById('logoPreviewContainer');

                if (url && url.trim()) {
                    preview.src = url;
                    preview.onerror = () => {
                        container.style.display = 'none';
                    };
                    preview.onload = () => {
                        container.style.display = 'block';
                    };
                } else {
                    container.style.display = 'none';
                }
            }

            searchClubs(query) {
                if (!query.trim()) {
                    this.filteredClubs = [...this.clubs];
                } else {
                    const searchTerm = query.toLowerCase();
                    this.filteredClubs = this.clubs.filter(club =>
                        club.arabicName.toLowerCase().includes(searchTerm) ||
                        club.englishName.toLowerCase().includes(searchTerm) ||
                        (club.league && club.league.toLowerCase().includes(searchTerm)) ||
                        (club.country && club.country.toLowerCase().includes(searchTerm))
                    );
                }

                this.currentPage = 1;
                this.renderClubs();
            }

            filterClubs(filter) {
                this.currentFilter = filter;

                switch (filter) {
                    case 'all':
                        this.filteredClubs = [...this.clubs];
                        break;
                    case 'with-logos':
                        this.filteredClubs = this.clubs.filter(club => club.logoUrl);
                        break;
                    case 'without-logos':
                        this.filteredClubs = this.clubs.filter(club => !club.logoUrl);
                        break;
                    case 'issues':
                        this.filteredClubs = this.clubs.filter(club =>
                            !club.logoUrl || !club.arabicName || !club.englishName
                        );
                        break;
                }

                this.currentPage = 1;
                this.renderClubs();
            }

            renderClubs() {
                const container = document.getElementById('clubsContainer');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const clubsToShow = this.filteredClubs.slice(startIndex, endIndex);

                if (clubsToShow.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-search fa-3x text-muted mb-3"></i>
                            <p class="text-muted">لا توجد أندية تطابق البحث</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = clubsToShow.map(club => `
                    <div class="club-item">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                ${club.logoUrl ?
                                    `<img src="${club.logoUrl}" class="club-logo-preview" alt="${club.arabicName}" onerror="this.style.display='none'">` :
                                    `<div class="club-logo-preview d-flex align-items-center justify-content-center">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>`
                                }
                            </div>
                            <div class="col-md-6">
                                <h6 class="mb-1">${club.arabicName}</h6>
                                <small class="text-muted">${club.englishName}</small>
                                <br>
                                <small class="text-info">${club.league} - ${club.country}</small>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-warning-manager btn-sm" onclick="logoManager.editClub('${club.id}')">
                                    <i class="fas fa-edit"></i> تعديل
                                </button>
                                <button class="btn btn-danger-manager btn-sm" onclick="logoManager.deleteClub('${club.id}')">
                                    <i class="fas fa-trash"></i> حذف
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                this.renderPagination();
            }

            renderPagination() {
                const totalPages = Math.ceil(this.filteredClubs.length / this.itemsPerPage);
                const pagination = document.getElementById('pagination');

                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }

                let paginationHTML = '';

                // Previous button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="logoManager.changePage(${this.currentPage - 1})">السابق</a>
                    </li>
                `;

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= this.currentPage - 2 && i <= this.currentPage + 2)) {
                        paginationHTML += `
                            <li class="page-item ${i === this.currentPage ? 'active' : ''}">
                                <a class="page-link" href="#" onclick="logoManager.changePage(${i})">${i}</a>
                            </li>
                        `;
                    } else if (i === this.currentPage - 3 || i === this.currentPage + 3) {
                        paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                    }
                }

                // Next button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="logoManager.changePage(${this.currentPage + 1})">التالي</a>
                    </li>
                `;

                pagination.innerHTML = paginationHTML;
            }

            changePage(page) {
                const totalPages = Math.ceil(this.filteredClubs.length / this.itemsPerPage);
                if (page >= 1 && page <= totalPages) {
                    this.currentPage = page;
                    this.renderClubs();
                }
            }

            editClub(clubId) {
                const club = this.clubs.find(c => c.id === clubId);
                if (!club) return;

                this.editingClub = club;

                document.getElementById('arabicName').value = club.arabicName || '';
                document.getElementById('englishName').value = club.englishName || '';
                document.getElementById('logoUrl').value = club.logoUrl || '';
                document.getElementById('league').value = club.league || '';
                document.getElementById('country').value = club.country || '';

                if (club.logoUrl) {
                    this.previewLogo(club.logoUrl);
                }

                // Scroll to form
                document.getElementById('clubForm').scrollIntoView({ behavior: 'smooth' });
            }

            async deleteClub(clubId) {
                if (!confirm('هل أنت متأكد من حذف هذا النادي؟')) return;

                try {
                    const index = this.clubs.findIndex(c => c.id === clubId);
                    if (index !== -1) {
                        this.clubs.splice(index, 1);
                        await this.saveToServer();
                        this.saveToLocalStorage(); // حفظ في localStorage

                        this.filteredClubs = this.filteredClubs.filter(c => c.id !== clubId);
                        this.renderClubs();
                        this.updateStatistics();

                        this.showNotification('تم حذف النادي بنجاح', 'success');
                    }
                } catch (error) {
                    console.error('🚨 Error deleting club:', error);
                    this.showNotification('خطأ في حذف النادي', 'error');
                }
            }

            updateStatistics() {
                const totalClubs = this.clubs.length;
                const clubsWithLogos = this.clubs.filter(c => c.logoUrl).length;
                const clubsWithoutLogos = totalClubs - clubsWithLogos;
                const mappingIssues = this.clubs.filter(c => !c.arabicName || !c.englishName).length;

                document.getElementById('totalClubsCount').textContent = totalClubs;
                document.getElementById('clubsWithLogosCount').textContent = clubsWithLogos;
                document.getElementById('clubsWithoutLogosCount').textContent = clubsWithoutLogos;
                document.getElementById('mappingIssuesCount').textContent = mappingIssues;
            }

            async syncWithExtractor() {
                try {
                    this.showLoading(true);
                    this.updateSyncStatus('syncing', 'جاري المزامنة مع المستخرج...');
                    this.showNotification('جاري المزامنة مع مستخرج الشعارات...', 'info');

                    // تحميل البيانات من المستخرج
                    await this.loadFromExtractor();

                    // تحديث العرض والإحصائيات
                    this.filteredClubs = [...this.clubs];
                    this.renderClubs();
                    this.updateStatistics();

                    this.updateSyncStatus('success', `متزامن - ${this.clubs.length} نادي`);
                    this.showNotification(`تم تحديث ${this.clubs.length} نادي بنجاح من المستخرج`, 'success');

                    console.log(`🔗 Synced ${this.clubs.length} clubs from extractor`);
                } catch (error) {
                    console.error('🚨 Error syncing with extractor:', error);
                    this.updateSyncStatus('error', 'خطأ في المزامنة');
                    this.showNotification('خطأ في المزامنة مع المستخرج', 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async loadFromExtractor() {
                try {
                    // تحميل البيانات من localStorage (المحدثة من المستخرج)
                    const verifiedClubs = localStorage.getItem('verifiedClubs');
                    const arabicMappings = localStorage.getItem('ARABIC_MAPPINGS');
                    const syncMetadata = localStorage.getItem('syncMetadata');

                    if (verifiedClubs) {
                        const clubsData = JSON.parse(verifiedClubs);

                        // تحويل البيانات إلى تنسيق مدير الشعارات
                        this.clubs = clubsData.map(club => ({
                            id: club.id || this.generateId(),
                            englishName: club.englishName,
                            arabicName: club.arabicName || club.englishName,
                            logoUrl: club.logoUrl,
                            league: club.league || 'غير محدد',
                            country: club.country || 'غير محدد',
                            city: club.city || 'غير محدد',
                            founded: club.founded,
                            stadium: club.stadium || 'غير محدد',
                            capacity: club.capacity,
                            website: club.website,
                            verified: club.verified || true,
                            extractedAt: club.extractedAt || new Date().toISOString(),
                            source: club.source || 'Real Verified Extractor',
                            lastUpdated: club.lastUpdated || new Date().toISOString(),
                            syncedFromExtractor: true
                        }));

                        console.log(`📥 Loaded ${this.clubs.length} clubs from extractor`);
                    }

                    // تحميل الترجمات العربية المحسنة
                    if (arabicMappings) {
                        const mappings = JSON.parse(arabicMappings);

                        // دمج الترجمات مع الأندية
                        this.clubs.forEach(club => {
                            if (mappings[club.englishName] && !club.arabicName) {
                                club.arabicName = mappings[club.englishName];
                            }
                        });

                        console.log(`📥 Applied Arabic mappings for clubs`);
                    }

                    // عرض معلومات المزامنة
                    if (syncMetadata) {
                        const metadata = JSON.parse(syncMetadata);
                        console.log('🔗 Sync metadata:', metadata);
                    }

                } catch (error) {
                    console.error('🚨 Error loading from extractor:', error);
                    throw error;
                }
            }

            exportData() {
                try {
                    const dataToExport = {
                        clubs: this.clubs,
                        exportDate: new Date().toISOString(),
                        totalClubs: this.clubs.length
                    };

                    const blob = new Blob([JSON.stringify(dataToExport, null, 2)], {
                        type: 'application/json'
                    });

                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `clubs-data-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    this.showNotification('تم تصدير البيانات بنجاح', 'success');
                } catch (error) {
                    console.error('🚨 Error exporting data:', error);
                    this.showNotification('خطأ في تصدير البيانات', 'error');
                }
            }

            showLoading(show) {
                const spinner = document.getElementById('loadingSpinner');
                spinner.style.display = show ? 'block' : 'none';
            }

            showNotification(message, type = 'info') {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    ${message}
                `;

                container.appendChild(notification);

                // Show notification
                setTimeout(() => notification.classList.add('show'), 100);

                // Hide notification after 5 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => container.removeChild(notification), 300);
                }, 5000);
            }
        }

        // Initialize manager when page loads
        const logoManager = new ClubLogoManager();
    </script>
</body>
</html>
