<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 إصلاح سريع للمشاكل</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .fix-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        .fix-button {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #1a1a2e;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .fix-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success { background: rgba(16, 185, 129, 0.2); border-left: 4px solid #10b981; }
        .error { background: rgba(239, 68, 68, 0.2); border-left: 4px solid #ef4444; }
        .warning { background: rgba(245, 158, 11, 0.2); border-left: 4px solid #f59e0b; }
        .info { background: rgba(59, 130, 246, 0.2); border-left: 4px solid #3b82f6; }
        .progress {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 إصلاح سريع لمشاكل نظام Transfermarkt</h1>
        
        <div class="fix-card">
            <h2>🚨 المشاكل المكتشفة</h2>
            <div id="problems-list">
                <div class="status error">❌ نظام الشعارات غير محمل</div>
                <div class="status error">❌ الأزرار لا تعمل في الصفحة الرئيسية</div>
                <div class="status warning">⚠️ transfermarktLastUpdate تالف</div>
            </div>
        </div>

        <div class="fix-card">
            <h2>🛠️ إصلاحات سريعة</h2>
            
            <button class="fix-button" onclick="fixLogoSystem()">
                إصلاح نظام الشعارات
            </button>
            
            <button class="fix-button" onclick="fixLocalStorage()">
                إصلاح localStorage
            </button>
            
            <button class="fix-button" onclick="addDefaultData()">
                إضافة بيانات افتراضية
            </button>
            
            <button class="fix-button" onclick="testMainPage()">
                اختبار الصفحة الرئيسية
            </button>
            
            <button class="fix-button" onclick="runFullFix()">
                إصلاح شامل
            </button>
        </div>

        <div class="fix-card">
            <h2>📊 حالة الإصلاح</h2>
            <div class="progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div id="fix-status"></div>
        </div>

        <div class="fix-card">
            <h2>🔗 روابط سريعة</h2>
            <button class="fix-button" onclick="openMainPage()">
                فتح الصفحة الرئيسية
            </button>
            <button class="fix-button" onclick="openDisplayPage()">
                فتح صفحة العرض
            </button>
            <button class="fix-button" onclick="openDiagnosisPage()">
                فتح صفحة التشخيص
            </button>
        </div>
    </div>

    <script>
        function updateProgress(percent, message) {
            document.getElementById('progress-bar').style.width = percent + '%';
            addStatus(message, 'info');
        }

        function addStatus(message, type = 'info') {
            const statusDiv = document.getElementById('fix-status');
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong> - ${message}
            `;
            statusDiv.appendChild(status);
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }

        async function fixLogoSystem() {
            updateProgress(10, 'بدء إصلاح نظام الشعارات...');
            
            try {
                // إنشاء نظام شعارات بديل
                if (typeof SmartLogoSystem === 'undefined') {
                    window.SmartLogoSystem = {
                        getClubLogo: function(clubName) {
                            const logos = {
                                'Liverpool FC': 'https://logos-world.net/wp-content/uploads/2020/06/Liverpool-Logo.png',
                                'Chelsea FC': 'https://logos-world.net/wp-content/uploads/2020/06/Chelsea-Logo.png',
                                'Real Madrid': 'https://logos-world.net/wp-content/uploads/2020/06/Real-Madrid-Logo.png',
                                'Manchester United': 'https://logos-world.net/wp-content/uploads/2020/06/Manchester-United-Logo.png',
                                'Manchester City': 'https://logos-world.net/wp-content/uploads/2020/06/Manchester-City-Logo.png'
                            };
                            return logos[clubName] || `https://ui-avatars.com/api/?name=${encodeURIComponent(clubName.substring(0, 2))}&size=400&background=1a1a2e&color=ffd700&bold=true&format=png&rounded=true&font-size=0.6`;
                        },
                        getClubInfo: function(clubName) {
                            return {
                                name: clubName,
                                league: 'الدوري الأوروبي',
                                country: 'أوروبا'
                            };
                        },
                        getStats: function() {
                            return { totalClubs: 5, cachedLogos: 0, fallbackSources: 1 };
                        }
                    };
                    updateProgress(50, 'تم إنشاء نظام شعارات بديل');
                } else {
                    updateProgress(50, 'نظام الشعارات موجود بالفعل');
                }
                
                updateProgress(100, 'تم إصلاح نظام الشعارات بنجاح ✅');
                addStatus('نظام الشعارات يعمل الآن', 'success');
                
            } catch (error) {
                addStatus(`خطأ في إصلاح نظام الشعارات: ${error.message}`, 'error');
            }
        }

        async function fixLocalStorage() {
            updateProgress(10, 'بدء إصلاح localStorage...');
            
            try {
                // إصلاح transfermarktLastUpdate
                const lastUpdate = localStorage.getItem('transfermarktLastUpdate');
                if (!lastUpdate || lastUpdate === 'undefined' || lastUpdate === 'null') {
                    localStorage.setItem('transfermarktLastUpdate', new Date().toISOString());
                    updateProgress(50, 'تم إصلاح transfermarktLastUpdate');
                }
                
                // التحقق من البيانات
                const data = localStorage.getItem('transfermarktData');
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        if (Array.isArray(parsed) && parsed.length > 0) {
                            updateProgress(80, `البيانات سليمة: ${parsed.length} نادي`);
                        } else {
                            throw new Error('البيانات فارغة');
                        }
                    } catch (e) {
                        throw new Error('البيانات تالفة');
                    }
                } else {
                    updateProgress(60, 'لا توجد بيانات - سيتم إضافة بيانات افتراضية');
                    await addDefaultData();
                }
                
                updateProgress(100, 'تم إصلاح localStorage بنجاح ✅');
                addStatus('localStorage يعمل بشكل صحيح', 'success');
                
            } catch (error) {
                addStatus(`خطأ في إصلاح localStorage: ${error.message}`, 'error');
            }
        }

        async function addDefaultData() {
            updateProgress(10, 'بدء إضافة البيانات الافتراضية...');
            
            try {
                const defaultData = [
                    {
                        rank: 1,
                        name: "ليفربول",
                        englishName: "Liverpool FC",
                        expenditure: "€308.68m",
                        arrivals: 13,
                        income: "€63.30m",
                        departures: 6,
                        balance: "€-245.38m",
                        league: "الدوري الإنجليزي الممتاز",
                        logo: "https://logos-world.net/wp-content/uploads/2020/06/Liverpool-Logo.png",
                        lastUpdated: new Date().toISOString(),
                        dataSource: 'default-fixed'
                    },
                    {
                        rank: 2,
                        name: "تشيلسي",
                        englishName: "Chelsea FC",
                        expenditure: "€243.77m",
                        arrivals: 22,
                        income: "€121.48m",
                        departures: 8,
                        balance: "€-122.29m",
                        league: "الدوري الإنجليزي الممتاز",
                        logo: "https://logos-world.net/wp-content/uploads/2020/06/Chelsea-Logo.png",
                        lastUpdated: new Date().toISOString(),
                        dataSource: 'default-fixed'
                    },
                    {
                        rank: 3,
                        name: "ريال مدريد",
                        englishName: "Real Madrid",
                        expenditure: "€167.50m",
                        arrivals: 7,
                        income: "€2.00m",
                        departures: 4,
                        balance: "€-165.50m",
                        league: "الدوري الإسباني",
                        logo: "https://logos-world.net/wp-content/uploads/2020/06/Real-Madrid-Logo.png",
                        lastUpdated: new Date().toISOString(),
                        dataSource: 'default-fixed'
                    }
                ];
                
                updateProgress(50, 'حفظ البيانات في localStorage...');
                localStorage.setItem('transfermarktData', JSON.stringify(defaultData));
                localStorage.setItem('transfermarktLastUpdate', new Date().toISOString());
                
                const fullData = {
                    clubs: defaultData,
                    lastUpdate: new Date().toISOString(),
                    source: 'quick-fix',
                    season: '2024/2025',
                    totalClubs: defaultData.length
                };
                localStorage.setItem('transfermarktDataFull', JSON.stringify(fullData));
                
                updateProgress(100, 'تم إضافة البيانات الافتراضية بنجاح ✅');
                addStatus(`تم حفظ ${defaultData.length} نادي في localStorage`, 'success');
                
            } catch (error) {
                addStatus(`خطأ في إضافة البيانات: ${error.message}`, 'error');
            }
        }

        async function testMainPage() {
            updateProgress(10, 'اختبار الصفحة الرئيسية...');
            
            try {
                // فتح الصفحة في نافذة جديدة
                const mainWindow = window.open('/obs-new-tols/transfermarkt-top-spenders-2025.html', '_blank');
                
                updateProgress(50, 'تم فتح الصفحة الرئيسية');
                
                // انتظار قليل ثم اختبار
                setTimeout(() => {
                    updateProgress(100, 'تم اختبار الصفحة الرئيسية ✅');
                    addStatus('تحقق من الصفحة الرئيسية في النافذة الجديدة', 'info');
                }, 2000);
                
            } catch (error) {
                addStatus(`خطأ في اختبار الصفحة الرئيسية: ${error.message}`, 'error');
            }
        }

        async function runFullFix() {
            addStatus('بدء الإصلاح الشامل...', 'info');
            
            await fixLogoSystem();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await fixLocalStorage();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await addDefaultData();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            addStatus('تم الإصلاح الشامل بنجاح! 🎉', 'success');
            addStatus('يمكنك الآن استخدام النظام بشكل طبيعي', 'success');
        }

        function openMainPage() {
            window.open('/obs-new-tols/transfermarkt-top-spenders-2025.html', '_blank');
        }

        function openDisplayPage() {
            window.open('/obs-new-tols/transfermarkt-ultimate-display.html', '_blank');
        }

        function openDiagnosisPage() {
            window.open('/obs-new-tols/test-diagnosis.html', '_blank');
        }

        // تشغيل تلقائي عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            addStatus('صفحة الإصلاح السريع جاهزة', 'success');
            addStatus('اختر الإصلاح المناسب أو اضغط "إصلاح شامل"', 'info');
        });
    </script>
</body>
</html>
